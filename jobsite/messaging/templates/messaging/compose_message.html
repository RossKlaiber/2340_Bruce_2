{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1 class="my-4">Compose Message</h1>
    <form class="my-4" method="post">
        {% csrf_token %}
        {% if recipient %}
        <p><strong>To:</strong> {{ recipient.username }}</p>
        {{ form.recipient }} {# Hidden input for recipient #}
        {% else %}
        <div class="form-group mb-3">
            <label for="{{ form.recipient.id_for_label }}">Recipient:</label>
            {{ form.recipient }}
        </div>
        {% endif %}
        <div class="form-group mb-2">
            <label for="{{ form.subject.id_for_label }}">Subject:</label>
            {{ form.subject }}
        </div>
        <div class="form-group">
            <label for="{{ form.body.id_for_label }}">Body:</label>
            {{ form.body }}
        </div>
        
        <button type="submit" class="btn btn-primary mt-4" id="sendMessageButton">Send Message</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const recipientField = document.getElementById('id_recipient');
        const subjectField = document.getElementById('id_subject');
        const bodyField = document.getElementById('id_body');
        const sendMessageButton = document.getElementById('sendMessageButton');

        function toggleSendMessageButton() {
            if (recipientField.value && subjectField.value && bodyField.value) {
                sendMessageButton.removeAttribute('disabled');
            } else {
                sendMessageButton.setAttribute('disabled', 'disabled');
            }
        }

        // Initial check
        toggleSendMessageButton();

        // Listen for changes
        recipientField.addEventListener('change', toggleSendMessageButton);
        recipientField.addEventListener('keyup', toggleSendMessageButton);
        bodyField.addEventListener('change', toggleSendMessageButton);
        bodyField.addEventListener('keyup', toggleSendMessageButton);
        subjectField.addEventListener('change', toggleSendMessageButton);
        subjectField.addEventListener('keyup', toggleSendMessageButton);
    });
</script>
{% endblock %}