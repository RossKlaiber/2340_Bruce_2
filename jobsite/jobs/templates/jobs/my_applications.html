{% extends 'base.html' %}
{% block content %}
<div class="p-3 mt-4">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>My Job Applications</h2>
          <div>
            <span class="badge bg-primary fs-6">{{ template_data.total_applications }} Total Application{{ template_data.total_applications|pluralize }}</span>
            <a href="{% url 'jobs.list' %}" class="btn btn-outline-primary ms-2">
              <i class="fas fa-search"></i> Browse Jobs
            </a>
          </div>
        </div>
        
        {% if template_data.applications %}
        
        <!-- Toggle View Buttons -->
        <div class="mb-4">
          <div class="btn-group" role="group" aria-label="View toggle">
            <button type="button" class="btn btn-outline-primary active" id="boardViewBtn">
              <i class="fas fa-columns"></i> Board View
            </button>
            <button type="button" class="btn btn-outline-primary" id="listViewBtn">
              <i class="fas fa-list"></i> List View
            </button>
          </div>
        </div>

        <!-- Board View -->
        <div id="boardView">
          <div class="row g-2">
            {% for group in template_data.status_groups %}
            <div class="col mb-3">
              <div class="card h-100">
                <div class="card-header bg-{{ group.color }} text-white">
                  <h6 class="card-title mb-0">
                    {{ group.name }}
                    <span class="badge bg-light text-dark ms-2">{{ group.count }}</span>
                  </h6>
                </div>
                <div class="card-body p-2">
                  {% for application in group.applications %}
                  <div class="card mb-2 shadow-sm application-card" data-status="{{ application.status }}">
                    <div class="card-body p-2">
                      <h6 class="card-title mb-1 text-truncate">
                        <a href="{% url 'jobs.detail' application.job.id %}" class="text-decoration-none">
                          {{ application.job.title }}
                        </a>
                      </h6>
                      <p class="card-text small text-muted mb-1">{{ application.job.company }}</p>
                      <p class="card-text small text-muted mb-1">
                        <i class="fas fa-map-marker-alt"></i> {{ application.job.location }}
                      </p>
                      <small class="text-muted">
                        Applied {{ application.applied_at|timesince }} ago
                      </small>
                    </div>
                  </div>
                  {% empty %}
                  <div class="text-center text-muted py-3">
                    <i class="fas fa-inbox"></i>
                    <br>
                    <small>No applications</small>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- List View -->
        <div id="listView" style="display: none;">
          {% for application in template_data.applications %}
          <div class="card mb-3 application-card" data-status="{{ application.status }}">
            <div class="card-body">
              <div class="row">
                <div class="col-md-8">
                  <h5 class="card-title">
                    <a href="{% url 'jobs.detail' application.job.id %}" class="text-decoration-none">
                      {{ application.job.title }}
                    </a>
                    <span class="badge bg-{{ application.get_status_color }} ms-2">
                      {{ application.get_status_display }}
                    </span>
                  </h5>
                  <h6 class="card-subtitle mb-2 text-muted">{{ application.job.company }}</h6>
                  <p class="card-text">
                    <i class="fas fa-map-marker-alt"></i> {{ application.job.location }} |
                    <i class="fas fa-briefcase"></i> {{ application.job.get_job_type_display }} |
                    <i class="fas fa-user-tie"></i> {{ application.job.get_experience_level_display }}
                  </p>
                  <p class="card-text">{{ application.job.description|truncatewords:30 }}</p>
                </div>
                <div class="col-md-4 text-end">
                  <div class="mb-2">
                    <span class="badge bg-success fs-6">{{ application.job.salary_range }}</span>
                  </div>
                  <small class="text-muted">
                    Applied {{ application.applied_at|timesince }} ago
                  </small>
                  {% if application.reviewed_at %}
                  <br>
                  <small class="text-muted">
                    Last updated {{ application.reviewed_at|timesince }} ago
                  </small>
                  {% endif %}
                  <div class="mt-2">
                    <a href="{% url 'jobs.detail' application.job.id %}" class="btn btn-outline-primary btn-sm">
                      View Job
                    </a>
                  </div>
                </div>
              </div>
              
              <!-- Application Details -->
              <hr>
              <div class="row">
                <div class="col-12">
                  <h6>Your Cover Note:</h6>
                  <p class="text-muted">{{ application.cover_note|linebreaks }}</p>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        {% else %}
        <div class="text-center py-5">
          <i class="fas fa-search fa-3x text-muted mb-3"></i>
          <h4>No applications yet</h4>
          <p class="text-muted">Start applying to jobs to track your application status here!</p>
          <a href="{% url 'jobs.list' %}" class="btn btn-primary">
            <i class="fas fa-search"></i> Browse Jobs
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const boardViewBtn = document.getElementById('boardViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const boardView = document.getElementById('boardView');
    const listView = document.getElementById('listView');
    
    // Toggle between board and list views
    boardViewBtn.addEventListener('click', function() {
        boardView.style.display = 'block';
        listView.style.display = 'none';
        boardViewBtn.classList.add('active');
        listViewBtn.classList.remove('active');
        localStorage.setItem('applicationsView', 'board');
    });
    
    listViewBtn.addEventListener('click', function() {
        boardView.style.display = 'none';
        listView.style.display = 'block';
        listViewBtn.classList.add('active');
        boardViewBtn.classList.remove('active');
        localStorage.setItem('applicationsView', 'list');
    });
    
    // Remember user preference
    const savedView = localStorage.getItem('applicationsView');
    if (savedView === 'list') {
        listViewBtn.click();
    }
});
</script>

<style>
.application-card {
    transition: transform 0.2s ease-in-out;
    cursor: pointer;
}

.application-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,0.125);
}

/* Kanban board styling */
#boardView .row {
    margin: 0;
}

#boardView .col {
    flex: 1;
    min-width: 0;
    max-width: none;
}

/* Ensure equal width columns that span full width */
#boardView .row > .col {
    flex-basis: 0;
    flex-grow: 1;
}

/* Mobile responsive */
@media (max-width: 768px) {
    #boardView .col {
        flex: 0 0 100%;
        max-width: 100%;
        margin-bottom: 1rem;
    }
    
    #boardView .row {
        flex-direction: column;
    }
}

/* Tablet responsive */
@media (min-width: 769px) and (max-width: 1024px) {
    #boardView .col {
        flex: 0 0 calc(50% - 0.5rem);
        max-width: calc(50% - 0.5rem);
    }
}
</style>
{% endblock content %}